(function(){"use strict";var t={7310:function(t,e,o){var i=o(2856),n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("video",{staticStyle:{position:"fixed",top:"10px",left:"10px","z-index":"1000",display:"none",border:"2px solid #2c3e50","border-radius":"8px"},attrs:{id:"webgazerVideoFeed"}}),e("div",{staticClass:"g-area"},[t._v("G区域")]),e("div",{staticClass:"container"},[e("div",{ref:"boxA",staticClass:"box box-a"},[t._v("区域A")]),e("div",{ref:"boxC",staticClass:"box box-c"},[t._v("区域C")]),e("div",{ref:"boxB",staticClass:"box box-b"},[t._v("区域B")])]),e("div",{ref:"boxF",staticClass:"box box-f"},[t._v("区域F")])])},a=[];o(4114),o(8111),o(8237),o(2489),o(116),o(7588),o(1701);class r{zoomArea(t,e=1.5){try{const o={a:"左侧任务区",b:"右上提示区",c:"中央代码区",g:"顶部",f:"底部工具条"};if(!(t in o)){const e=`非法区域: ${t}, 有效区域: ${Object.keys(o).join(", ")}`;throw console.error(e),new Error(e)}return this.onZoomChange||(console.warn("onZoomChange回调未设置，使用默认回调"),this.onZoomChange=t=>{console.log("默认zoom回调:",t),window.updateZoomState&&window.updateZoomState(t)}),this.resetZoom(),this.zoomState[t]=e,console.log(`区域 ${t} 已放大 ${e} 倍`),"function"===typeof this.onZoomChange?this.onZoomChange({zoomedArea:t,zoomState:this.zoomState,timestamp:Date.now()}):console.warn("onZoomChange回调不是函数，无法触发UI更新"),this.zoomState}catch(o){throw console.error("缩放区域时出错:",o),o}}resetZoom(){return this.zoomState={a:1,b:1,c:1,f:1,g:1},console.log("所有区域缩放已重置为默认值"),this.onZoomReset&&this.onZoomReset(this.zoomState),this.zoomState}constructor(){this.zoomState={a:1,b:1,c:1,f:1,g:1},this.onZoomChange=t=>{console.log("默认zoom回调:",t),window.updateZoomState&&window.updateZoomState(t)},this.onZoomReset=t=>{console.log("默认zoom重置回调:",t),window.updateZoomState&&window.updateZoomState(t)},this.screenConfig={diagonalInches:24,resolution:{width:3840,height:2160},ppi:92,aoiRatios:{a:.2,c:.6,bf:.2,g:0}},this.confirmationState={direct:0,referential:0,exploratory:0,lastConfirmedType:null},this.config={windowSize:5e3,entropyThresholds:{low:1.2,high:1.8},coverageThresholds:{directMax:2,referentialMin:2,referentialMax:3,exploratoryMin:3},gazeDurationThresholds:{short:200,long:500},saccadeThresholds:{small:50,medium:150,large:300},confirmationWindows:2},this.currentWindow={startTime:null,gazeData:[],aoiStats:{a:{count:0,duration:0},b:{count:0,duration:0},c:{count:0,duration:0},f:{count:0,duration:0},g:{count:0,duration:0}},saccadeAmplitudes:[]}}addGazePoint(t,e){if(t.timestamp=e,this.currentWindow.startTime||(this.currentWindow.startTime=e),t.aoi||(t.aoi=this.determineAOI(t.x,t.y)),this.currentWindow.aoiStats[t.aoi]&&(this.currentWindow.aoiStats[t.aoi].count++,this.currentWindow.aoiStats[t.aoi].duration+=t.duration),this.currentWindow.gazeData.length>0){const o=this.currentWindow.gazeData.slice().reverse().find(t=>t.timestamp>e-2e3);if(o){const e=Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2));this.currentWindow.saccadeAmplitudes.push(e)}}this.currentWindow.gazeData.push(t);const o=e;if(!this.currentWindow.startTime)return this.currentWindow.startTime=o,null;const i=o-this.currentWindow.startTime;if(i<this.config.windowSize)return console.log(`严格等待5秒: ${i/1e3}s/5s`),null;console.log("5秒窗口已满，开始分析");const n=this.classifyUser();return console.log("分类结果:",JSON.stringify(n,null,2)),this.currentWindow={startTime:o,gazeData:[],aoiStats:{a:{count:0,duration:0},b:{count:0,duration:0},c:{count:0,duration:0},f:{count:0,duration:0},g:{count:0,duration:0}},saccadeAmplitudes:[]},n}determineAOI(t,e){const o=this.screenConfig.resolution.width,i=o*this.screenConfig.aoiRatios.a,n=o*this.screenConfig.aoiRatios.c;return t<i?"a":t<i+n?"c":e<this.screenConfig.resolution.height/2?"b":"f"}classifyUser(){const t=Object.values(this.currentWindow.aoiStats).reduce((t,e)=>t+(e?.count||0),0)||1,e=Object.values(this.currentWindow.aoiStats).reduce((t,e)=>t+(e?.duration||0),0)||1,o={};for(const[h,m]of Object.entries(this.currentWindow.aoiStats))o[h]={countProportion:(m?.count||0)/t,durationProportion:(m?.duration||0)/e,rawCount:m?.count||0,rawDuration:m?.duration||0};console.log("AOI比例计算结果:",JSON.stringify(o,null,2));const i=this.calculateMedian(this.currentWindow.saccadeAmplitudes),n=this.calculateEntropy(Object.values(o).map(t=>t.countProportion)),a=Object.values(o).filter(t=>t.countProportion>.05).length,r=this.currentWindow.gazeData.map(t=>t.duration),s=this.calculateMedian(r),c={a:o.a.countProportion/this.screenConfig.aoiRatios.a,c:o.c.countProportion/this.screenConfig.aoiRatios.c,b:o.b.countProportion/(this.screenConfig.aoiRatios.bf/2),f:o.f.countProportion/(this.screenConfig.aoiRatios.bf/2)};let l="unknown";s>=260&&i<=54.3&&a<=2?(console.log("满足直接型条件:",{medianGazeDuration:s,medianSaccade:i,coverage:a}),alert("直接型"),l="direct"):s>=180&&s<260&&i>54.3&&i<126.7&&a>=2&&a<=3?(alert("对照型"),l="referential"):s<=180&&i>=126.7&&a>=3&&(alert("探索型"),l="exploratory"),console.log("分类结果判定依据:",{userType:l,medianGazeDuration:s,medianSaccade:i,coverage:a}),this.lastClassificationStats={medianSaccade:i,entropy:n,coverage:a,medianGazeDuration:s,aoiProportions:o,densityMetrics:c,gazeCount:t};const u={userType:l||"unknown",zoomedArea:null,stats:{medianSaccade:i,entropy:n,coverage:a,medianGazeDuration:s,aoiProportions:o,densityMetrics:c,gazeCount:t,windowDuration:Date.now()-this.currentWindow.startTime},uiRecommendation:this.getUIRecommendation(l),timestamp:(new Date).toISOString(),_diagnostics:{cProportion:o.c?.countProportion,cDuration:o.c?.rawDuration,totalDuration:e}};if(this.onZoomChange||(this.onZoomChange=t=>{console.log("Zoom状态变化:",t),window.updateZoomState?window.updateZoomState(t):console.warn("window.updateZoomState 未定义，请确保UI监听器已设置")},console.log("已设置默认zoom回调函数")),"unknown"!==l){console.log("检测到用户类型:",l,"详细统计:",{proportions:o,saccade:i,entropy:n,coverage:a,gazeDuration:s}),this.confirmationState.lastConfirmedType=l;const t=["a","b","c","f"];let e=null;try{e=Object.entries(this.currentWindow.aoiStats).filter(([e])=>t.includes(e)).reduce((t,e)=>t[1]&&e[1]?t[1].duration>e[1].duration?t:e:t)}catch(d){console.error("计算注视时长时出错:",d)}e&&e[1].duration>0?(u.zoomedArea=e[0],console.log(`将放大注视最久的区域: ${u.zoomedArea} (时长: ${e[1].duration}ms)`),this.zoomArea(u.zoomedArea)):(console.log("无显著注视区域，保持默认"),this.resetZoom())}else{console.log("未分类诊断详情:",{thresholds:{direct:{medianGazeDuration:260,medianSaccade:54.3,coverage:2},referential:{medianGazeDurationLow:180,medianGazeDurationHigh:260,medianSaccadeLow:54.3,medianSaccadeHigh:126.7,coverageLow:2,coverageHigh:3},exploratory:{medianGazeDuration:180,medianSaccade:126.7,coverage:3}},actualValues:{medianGazeDuration:s,medianSaccade:i,coverage:a},metConditions:{direct:s>=260&&i<=54.3&&a<=2,referential:s>=180&&s<260&&i>54.3&&i<126.7&&a>=2&&a<=3,exploratory:s<=180&&i>=126.7&&a>=3}}),this.resetZoom();const t=["a","b","c","f"],e=Object.entries(this.currentWindow.aoiStats).filter(([e])=>t.includes(e)).reduce((t,e)=>t[1].duration>e[1].duration?t:e,[null,{duration:0}]);e[0]&&e[1].duration>0&&(u.zoomedArea=e[0],console.log(`自动选择注视最久的区域: ${u.zoomedArea} (时长: ${e[1].duration}ms)`),this.zoomArea(u.zoomedArea))}this.resetWindow();for(const h in this.confirmationState)this.confirmationState[h]=0;return u}calculateEntropy(t){return-t.reduce((t,e)=>e>0?t+e*Math.log2(e):t,0)}calculateMedian(t){if(0===t.length)return 0;const e=[...t].sort((t,e)=>t-e),o=Math.floor(e.length/2);return e.length%2===0?(e[o-1]+e[o])/2:e[o]}getUIRecommendation(t){switch(t){case"direct":return{layout:"focus",description:"简化界面，突出代码编辑区",components:{taskPanel:{visible:!0,collapsed:!0},outputPanel:{visible:!1}}};case"referential":return{layout:"balanced",description:"保持三栏布局，确保参考信息可见",components:{taskPanel:{visible:!0,collapsed:!1},outputPanel:{visible:!0,split:"vertical"}}};case"exploratory":return{layout:"guided",description:"提供更多引导和文档链接",components:{taskPanel:{visible:!0,collapsed:!1},outputPanel:{visible:!0,split:"horizontal"}}};default:return{layout:"default",description:"保持当前UI布局",components:{}}}}resetWindow(){const t={startTime:null,gazeData:[],aoiStats:{a:{count:0,duration:0},b:{count:0,duration:0},c:{count:0,duration:0},f:{count:0,duration:0},g:{count:0,duration:0}},saccadeAmplitudes:[]};if(this.currentWindow.gazeData.length>0){const e=Date.now(),o=this.currentWindow.gazeData.filter(t=>e-t.timestamp<this.config.windowSize);o.length>0&&(t.startTime=o[0].timestamp,t.gazeData=o,o.forEach(e=>{t.aoiStats[e.aoi]&&(t.aoiStats[e.aoi].count++,t.aoiStats[e.aoi].duration+=e.duration)}))}this.currentWindow=t,console.log("窗口已重置，保留未过期数据:",t.gazeData.length)}getLastClassification(){return this.confirmationState.lastConfirmedType?{userType:this.confirmationState.lastConfirmedType,timestamp:(new Date).toISOString(),stats:this.lastClassificationStats||{}}:null}}const s=new r;class c{constructor(){this.isInitialized=!1,this.retryCount=0,this.maxRetries=3}async init(){try{return await this.loadScript(),await webgazer.setRegression("ridge").setTracker("clmtrackr").begin(),this.isInitialized=!0,!0}catch(t){if(console.error("WebGazer初始化失败:",t),this.retryCount<this.maxRetries)return this.retryCount++,console.log(`正在重试初始化 (${this.retryCount}/${this.maxRetries})`),new Promise(t=>{setTimeout(async()=>{t(await this.init())},2e3)});throw t}}loadScript(){return new Promise((t,e)=>{if("undefined"!==typeof webgazer)return t();const o=document.createElement("script");o.src="https://webgazer.cs.brown.edu/webgazer.js",o.onload=t,o.onerror=e,document.head.appendChild(o)})}}const l=new c;var u={name:"App",components:{},data(){return{gazeDuration:{a:0,b:0,c:0,f:0,g:0},gazeStartTime:{a:null,b:null,c:null,f:null,g:null},currentZoom:null,loading:!1,gazeTimer:null,userType:null,userTypeHistory:[],stats:{medianSaccade:0,entropy:0,coverage:"0%",medianGazeDuration:0,gazeCount:0}}},mounted(){console.log("App组件已挂载"),window.updateZoomState=t=>{console.log("收到缩放状态更新:",t),this.$nextTick(()=>{this.zoomArea(t.zoomedArea)})},this.setupEyeTracking?this.setupEyeTracking():console.error("setupEyeTracking方法未定义")},beforeUnmount(){this.gazeTimer&&clearInterval(this.gazeTimer),webgazer.clearGazeListener(),webgazer.stopVideo(),webgazer.stop()},methods:{async setupEyeTracking(){try{console.log("开始初始化眼动跟踪..."),this.loading=!0,await l.init();const t=document.getElementById("webgazerVideoFeed");t.style.display="block",t.style.position="fixed",t.style.top="10px",t.style.left="10px",t.style.zIndex="1000",t.style.border="2px solid #2c3e50",t.style.borderRadius="8px",t.width=320,t.height=240,webgazer.setGazeListener((t,e)=>{t&&(console.log("检测到注视点:",t),this.checkGazePosition(t.x,t.y),this.loading=!1,this.gazeTimer||(console.log("启动5秒统计定时器..."),this.gazeTimer=setInterval(()=>{console.log("5秒统计周期触发"),this.determineZoomArea()},5e3)))})}catch(t){console.error("眼动跟踪初始化失败:",t),this.showErrorNotification(t),this.loading=!1}},showErrorNotification(t){this.$notify.error({title:"眼动跟踪初始化失败",message:`原因: ${t.message}`,duration:0,showClose:!0})},checkGazePosition(t,e){const o=Date.now();if(!this.$refs.boxA||!this.$refs.boxB||!this.$refs.boxC)return void console.error("区域元素未找到");let i={};try{i={a:this.$refs.boxA.getBoundingClientRect(),b:this.$refs.boxB.getBoundingClientRect(),c:this.$refs.boxC.getBoundingClientRect()}}catch(a){return void console.error("获取元素位置失败:",a)}let n="g";for(const[r,s]of Object.entries(i))if(t>=s.left&&t<=s.right&&e>=s.top&&e<=s.bottom){n=r;break}if("g"!==n){this.gazeStartTime[n]||(this.gazeStartTime[n]=o,console.log(`开始注视区域 ${n}`));const i=o-(this.gazeStartTime[n]||o);this.gazeDuration[n]+=i,this.gazeStartTime[n]=o,console.log(`区域 ${n} 累计注视时间: ${this.gazeDuration[n]}ms`);const a=s.addGazePoint({x:t,y:e,aoi:n,duration:i},o);a&&(this.$set(this,"userType",a.userType),this.$set(this,"stats",a.stats),this.userTypeHistory.push(a),console.log("用户分类结果:",{type:a.userType,stats:a.stats,zoomArea:a.zoomedArea}),this.$forceUpdate())}else{const i=s.addGazePoint({x:t,y:e,aoi:"g",duration:100},o);i&&(this.userType=i.userType,this.stats=i.stats,this.userTypeHistory.push(i),console.log("用户分类结果:",i))}for(const r of["a","b","c","f"])n!==r&&this.gazeStartTime[r]&&(console.log(`离开区域 ${r}`),this.gazeStartTime[r]=null)},determineZoomArea(){console.log("5秒统计周期结束，开始分析注视数据");const t=s.getLastClassification();if(t)if(this.$set(this,"userType",t.userType),this.$set(this,"stats",t.stats),"direct"===t.userType)this.zoomArea("c");else if("referential"===t.userType){const t=Object.entries(this.gazeDuration).reduce((t,e)=>t[1]>e[1]?t:e)[0];this.gazeDuration[t]>0&&this.zoomArea(t)}else s.resetZoom();this.gazeDuration={a:0,b:0,c:0,f:0,g:0},console.log("已重置注视时间统计")},zoomArea(t){if(!t)return console.log("重置所有区域缩放"),void this.resetAllZoom();console.log(`准备放大区域 ${t}`),this.resetAllZoom();const e=this.$refs[`box${t.toUpperCase()}`];e?(e.style.transform="scale(1.5)",e.style.zIndex="10",e.style.transition="transform 0.3s ease",console.log(`已放大区域 ${t}`),this.currentZoom=t):console.error(`找不到区域 ${t} 的DOM元素`),this.gazeStartTime[t]=null},resetAllZoom(){["A","B","C"].forEach(t=>{const e=this.$refs[`box${t}`];e&&(e.style.transform="",e.style.zIndex="")}),this.currentZoom=null}}},d=u,h=o(1656),m=(0,h.A)(d,n,a,!1,null,null,null),g=m.exports,f=o(4927),p=o.n(f);i["default"].config.productionTip=!1,i["default"].use(p()),new i["default"]({render:t=>t(g)}).$mount("#app")}},e={};function o(i){var n=e[i];if(void 0!==n)return n.exports;var a=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=t,function(){o.amdO={}}(),function(){var t=[];o.O=function(e,i,n,a){if(!i){var r=1/0;for(u=0;u<t.length;u++){i=t[u][0],n=t[u][1],a=t[u][2];for(var s=!0,c=0;c<i.length;c++)(!1&a||r>=a)&&Object.keys(o.O).every(function(t){return o.O[t](i[c])})?i.splice(c--,1):(s=!1,a<r&&(r=a));if(s){t.splice(u--,1);var l=n();void 0!==l&&(e=l)}}return e}a=a||0;for(var u=t.length;u>0&&t[u-1][2]>a;u--)t[u]=t[u-1];t[u]=[i,n,a]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){o.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={524:0};o.O.j=function(e){return 0===t[e]};var e=function(e,i){var n,a,r=i[0],s=i[1],c=i[2],l=0;if(r.some(function(e){return 0!==t[e]})){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(c)var u=c(o)}for(e&&e(i);l<r.length;l++)a=r[l],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return o.O(u)},i=self["webpackChunkdemo"]=self["webpackChunkdemo"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=o.O(void 0,[504],function(){return o(7310)});i=o.O(i)})();
//# sourceMappingURL=app.be8fad10.js.map