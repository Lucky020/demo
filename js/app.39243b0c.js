(function(){"use strict";var t={378:function(t,o,e){var i=e(2856),n=function(){var t=this,o=t._self._c;return o("div",{attrs:{id:"app"}},[o("video",{staticStyle:{position:"fixed",top:"10px",left:"10px","z-index":"1000",display:"none",border:"2px solid #2c3e50","border-radius":"8px"},attrs:{id:"webgazerVideoFeed"}}),o("div",{staticClass:"container"},[o("div",{ref:"boxA",staticClass:"box box-a"},[t._v("区域A")]),o("div",{ref:"boxB",staticClass:"box box-b"},[t._v("区域B")]),o("div",{ref:"boxC",staticClass:"box box-c"},[t._v("区域C")])]),o("div",{staticClass:"stats"},[o("p",[t._v("注视统计 (5秒内):")]),o("p",[t._v("A区域: "+t._s(t.gazeDuration.a)+"ms")]),o("p",[t._v("B区域: "+t._s(t.gazeDuration.b)+"ms")]),o("p",[t._v("C区域: "+t._s(t.gazeDuration.c)+"ms")]),o("p",[t._v("F区域: "+t._s(t.gazeDuration.f)+"ms")]),o("p",[t._v("G区域: "+t._s(t.gazeDuration.g)+"ms")]),t.loading?o("p",{staticStyle:{color:"#f39c12"}},[t._v("正在初始化眼动跟踪...")]):t._e()]),o("div",{staticClass:"user-type",class:t.userType},["direct"===t.userType?o("p",[t._v("用户类型: 直接型 (Direct)")]):"referential"===t.userType?o("p",[t._v("用户类型: 对照型 (Referential)")]):"exploratory"===t.userType?o("p",[t._v("用户类型: 探索型 (Exploratory)")]):o("p",[t._v("用户类型: 未确定")])]),t.stats?o("div",{staticClass:"stat-details"},[o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[t._v("扫视幅度:")]),o("span",[t._v(t._s(t.stats.medianSaccade.toFixed(1))+"px")])]),o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[t._v("AOI熵:")]),o("span",[t._v(t._s(t.stats.entropy.toFixed(2)))])]),o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[t._v("覆盖区域:")]),o("span",[t._v(t._s(t.stats.coverage))])]),o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[t._v("注视时长:")]),o("span",[t._v(t._s(t.stats.medianGazeDuration.toFixed(1))+"ms")])]),o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[t._v("注视点数量:")]),o("span",[t._v(t._s(t.stats.gazeCount))])])]):t._e()])},s=[];e(4114),e(8111),e(8237),e(2489),e(116),e(7588),e(1701);class a{zoomArea(t,o=1.5){try{const e={a:"左侧任务区",b:"右上提示区",c:"中央代码区",f:"右下历史区"};if(!(t in e)){const o=`非法区域: ${t}, 有效区域: ${Object.keys(e).join(", ")}`;throw console.error(o),new Error(o)}return this.onZoomChange||(console.warn("onZoomChange回调未设置，使用默认回调"),this.onZoomChange=t=>{console.log("默认zoom回调:",t),window.updateZoomState&&window.updateZoomState(t)}),this.resetZoom(),this.zoomState[t]=o,console.log(`区域 ${t} 已放大 ${o} 倍`),"function"===typeof this.onZoomChange?this.onZoomChange({zoomedArea:t,zoomState:this.zoomState,timestamp:Date.now()}):console.warn("onZoomChange回调不是函数，无法触发UI更新"),this.zoomState}catch(e){throw console.error("缩放区域时出错:",e),e}}resetZoom(){return this.zoomState={a:1,b:1,c:1,f:1,g:1},console.log("所有区域缩放已重置为默认值"),this.onZoomReset&&this.onZoomReset(this.zoomState),this.zoomState}constructor(){this.zoomState={a:1,b:1,c:1,f:1,g:1},this.onZoomChange=t=>{console.log("默认zoom回调:",t),window.updateZoomState&&window.updateZoomState(t)},this.onZoomReset=t=>{console.log("默认zoom重置回调:",t),window.updateZoomState&&window.updateZoomState(t)},this.screenConfig={diagonalInches:24,resolution:{width:1920,height:1080},ppi:92,aoiRatios:{a:.2,c:.6,bf:.2,g:0}},this.confirmationState={direct:0,referential:0,exploratory:0,lastConfirmedType:null},this.config={windowSize:5e3,entropyThresholds:{low:1.2,high:1.8},coverageThresholds:{directMax:2,referentialMin:2,referentialMax:3,exploratoryMin:3},gazeDurationThresholds:{short:200,long:500},saccadeThresholds:{small:50,medium:150,large:300},confirmationWindows:2},this.currentWindow={startTime:null,gazeData:[],aoiStats:{a:{count:0,duration:0},b:{count:0,duration:0},c:{count:0,duration:0},f:{count:0,duration:0},g:{count:0,duration:0}},saccadeAmplitudes:[]}}addGazePoint(t,o){if(t.timestamp=o,this.currentWindow.startTime||(this.currentWindow.startTime=o),t.aoi||(t.aoi=this.determineAOI(t.x,t.y)),this.currentWindow.aoiStats[t.aoi]&&(this.currentWindow.aoiStats[t.aoi].count++,this.currentWindow.aoiStats[t.aoi].duration+=t.duration),this.currentWindow.gazeData.length>0){const e=this.currentWindow.gazeData.slice().reverse().find(t=>t.timestamp>o-2e3);if(e){const o=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));this.currentWindow.saccadeAmplitudes.push(o)}}this.currentWindow.gazeData.push(t);const e=o;if(!this.currentWindow.startTime)return this.currentWindow.startTime=e,null;const i=e-this.currentWindow.startTime;if(i<this.config.windowSize)return console.log(`严格等待5秒: ${i/1e3}s/5s`),null;console.log("5秒窗口已满，开始分析");const n=this.classifyUser();return console.log("分类结果:",JSON.stringify(n,null,2)),this.currentWindow={startTime:e,gazeData:[],aoiStats:{a:{count:0,duration:0},b:{count:0,duration:0},c:{count:0,duration:0},f:{count:0,duration:0},g:{count:0,duration:0}},saccadeAmplitudes:[]},n}determineAOI(t,o){const e=this.screenConfig.resolution.width,i=e*this.screenConfig.aoiRatios.a,n=e*this.screenConfig.aoiRatios.c;return t<i?"a":t<i+n?"c":o<this.screenConfig.resolution.height/2?"b":"f"}classifyUser(){const t=Object.values(this.currentWindow.aoiStats).reduce((t,o)=>t+(o?.count||0),0)||1,o=Object.values(this.currentWindow.aoiStats).reduce((t,o)=>t+(o?.duration||0),0)||1,e={};for(const[p,f]of Object.entries(this.currentWindow.aoiStats))e[p]={countProportion:(f?.count||0)/t,durationProportion:(f?.duration||0)/o,rawCount:f?.count||0,rawDuration:f?.duration||0};console.log("AOI比例计算结果:",JSON.stringify(e,null,2));const i=this.calculateMedian(this.currentWindow.saccadeAmplitudes),n=this.calculateEntropy(Object.values(e).map(t=>t.countProportion)),s=Object.values(e).filter(t=>t.countProportion>.05).length,a=this.currentWindow.gazeData.map(t=>t.duration),r=this.calculateMedian(a),c={a:e.a.countProportion/this.screenConfig.aoiRatios.a,c:e.c.countProportion/this.screenConfig.aoiRatios.c,b:e.b.countProportion/(this.screenConfig.aoiRatios.bf/2),f:e.f.countProportion/(this.screenConfig.aoiRatios.bf/2)};let l="unknown";const u=JSON.stringify(e.c.countProportion)||0,d=JSON.stringify(c.c)||0;u>=.2&&d>.3&&r>=10?(console.log("满足直接型条件:",{cProportion:u,cDensity:d,gazeDuration:r}),l="direct",console.log("检测到直接型用户:",{cProportion:e.c.countProportion,density:c.c,duration:r,entropy:n,coverage:s})):JSON.stringify(e.c.countProportion)+JSON.stringify(e.b.countProportion)>=.5&&Math.abs(JSON.stringify(c.c)-JSON.stringify(c.b))<.8&&r>=150?l="referential":JSON.stringify(i)>=JSON.stringify(this.config.saccadeThresholds.large)&&JSON.stringify(n)>=JSON.stringify(this.config.entropyThresholds.high)&&JSON.stringify(s)>=JSON.stringify(this.config.coverageThresholds.exploratoryMin)&&JSON.stringify(e.g.countProportion)>.1&&JSON.stringify(c.c)<1.5&&JSON.stringify(r)<1e3&&(l="exploratory"),this.lastClassificationStats={medianSaccade:i,entropy:n,coverage:s,medianGazeDuration:r,aoiProportions:e,densityMetrics:c,gazeCount:t};const h={userType:l||"unknown",zoomedArea:null,stats:{medianSaccade:i,entropy:n,coverage:s,medianGazeDuration:r,aoiProportions:e,densityMetrics:c,gazeCount:t,windowDuration:Date.now()-this.currentWindow.startTime},uiRecommendation:this.getUIRecommendation(l),timestamp:(new Date).toISOString(),_diagnostics:{cProportion:e.c?.countProportion,cDuration:e.c?.rawDuration,totalDuration:o}};if(this.onZoomChange||(this.onZoomChange=t=>{console.log("Zoom状态变化:",t),window.updateZoomState?window.updateZoomState(t):console.warn("window.updateZoomState 未定义，请确保UI监听器已设置")},console.log("已设置默认zoom回调函数")),"unknown"!==l){console.log("检测到用户类型:",l,"详细统计:",{proportions:e,saccade:i,entropy:n,coverage:s,gazeDuration:r}),this.confirmationState.lastConfirmedType=l;const t=["a","b","c","f"];let o=null;try{o=Object.entries(this.currentWindow.aoiStats).filter(([o])=>t.includes(o)).reduce((t,o)=>t[1]&&o[1]?t[1].duration>o[1].duration?t:o:t)}catch(g){console.error("计算注视时长时出错:",g)}o&&o[1].duration>0?(h.zoomedArea=o[0],console.log(`将放大注视最久的区域: ${h.zoomedArea} (时长: ${o[1].duration}ms)`),this.zoomArea(h.zoomedArea)):(console.log("无显著注视区域，保持默认"),this.resetZoom())}else{console.log("未分类诊断详情:",{thresholds:{direct:{cProportion:.2,density:.3,duration:200},referential:{minCombined:.5,maxDensityDiff:.8,minDuration:150}},actualValues:{cProportion:e.c?.countProportion,bProportion:e.b?.countProportion,cDensity:c.c,bDensity:c.b,gazeDuration:r,densityDiff:Math.abs(c.c-c.b)},metConditions:{direct:e.c?.countProportion>=.2&&c.c>.3&&r>=200,referential:e.c.countProportion+e.b.countProportion>=.5&&Math.abs(c.c-c.b)<.8&&r>=150}}),this.resetZoom();const t=["a","b","c","f"],o=Object.entries(this.currentWindow.aoiStats).filter(([o])=>t.includes(o)).reduce((t,o)=>t[1].duration>o[1].duration?t:o,[null,{duration:0}]);o[0]&&o[1].duration>0&&(h.zoomedArea=o[0],console.log(`自动选择注视最久的区域: ${h.zoomedArea} (时长: ${o[1].duration}ms)`),this.zoomArea(h.zoomedArea))}this.resetWindow();for(const p in this.confirmationState)this.confirmationState[p]=0;return h}calculateEntropy(t){return-t.reduce((t,o)=>o>0?t+o*Math.log2(o):t,0)}calculateMedian(t){if(0===t.length)return 0;const o=[...t].sort((t,o)=>t-o),e=Math.floor(o.length/2);return o.length%2===0?(o[e-1]+o[e])/2:o[e]}getUIRecommendation(t){switch(t){case"direct":return{layout:"focus",description:"简化界面，突出代码编辑区",components:{taskPanel:{visible:!0,collapsed:!0},outputPanel:{visible:!1}}};case"referential":return{layout:"balanced",description:"保持三栏布局，确保参考信息可见",components:{taskPanel:{visible:!0,collapsed:!1},outputPanel:{visible:!0,split:"vertical"}}};case"exploratory":return{layout:"guided",description:"提供更多引导和文档链接",components:{taskPanel:{visible:!0,collapsed:!1},outputPanel:{visible:!0,split:"horizontal"}}};default:return{layout:"default",description:"保持当前UI布局",components:{}}}}resetWindow(){const t={startTime:null,gazeData:[],aoiStats:{a:{count:0,duration:0},b:{count:0,duration:0},c:{count:0,duration:0},f:{count:0,duration:0},g:{count:0,duration:0}},saccadeAmplitudes:[]};if(this.currentWindow.gazeData.length>0){const o=Date.now(),e=this.currentWindow.gazeData.filter(t=>o-t.timestamp<this.config.windowSize);e.length>0&&(t.startTime=e[0].timestamp,t.gazeData=e,e.forEach(o=>{t.aoiStats[o.aoi]&&(t.aoiStats[o.aoi].count++,t.aoiStats[o.aoi].duration+=o.duration)}))}this.currentWindow=t,console.log("窗口已重置，保留未过期数据:",t.gazeData.length)}getLastClassification(){return this.confirmationState.lastConfirmedType?{userType:this.confirmationState.lastConfirmedType,timestamp:(new Date).toISOString(),stats:this.lastClassificationStats||{}}:null}}const r=new a;class c{constructor(){this.isInitialized=!1,this.retryCount=0,this.maxRetries=3}async init(){try{return await this.loadScript(),await webgazer.setRegression("ridge").setTracker("clmtrackr").begin(),this.isInitialized=!0,!0}catch(t){if(console.error("WebGazer初始化失败:",t),this.retryCount<this.maxRetries)return this.retryCount++,console.log(`正在重试初始化 (${this.retryCount}/${this.maxRetries})`),new Promise(t=>{setTimeout(async()=>{t(await this.init())},2e3)});throw t}}loadScript(){return new Promise((t,o)=>{if("undefined"!==typeof webgazer)return t();const e=document.createElement("script");e.src="https://webgazer.cs.brown.edu/webgazer.js",e.onload=t,e.onerror=o,document.head.appendChild(e)})}}const l=new c;var u={name:"App",components:{},data(){return{gazeDuration:{a:0,b:0,c:0,f:0,g:0},gazeStartTime:{a:null,b:null,c:null,f:null,g:null},currentZoom:null,loading:!1,gazeTimer:null,userType:null,userTypeHistory:[],stats:null}},mounted(){console.log("App组件已挂载"),window.updateZoomState=t=>{console.log("收到缩放状态更新:",t),this.$nextTick(()=>{this.zoomArea(t.zoomedArea)})},this.setupEyeTracking?this.setupEyeTracking():console.error("setupEyeTracking方法未定义")},beforeUnmount(){this.gazeTimer&&clearInterval(this.gazeTimer),webgazer.clearGazeListener(),webgazer.stopVideo(),webgazer.stop()},methods:{async setupEyeTracking(){try{console.log("开始初始化眼动跟踪..."),this.loading=!0,await l.init();const t=document.getElementById("webgazerVideoFeed");t.style.display="block",t.style.position="fixed",t.style.top="10px",t.style.left="10px",t.style.zIndex="1000",t.style.border="2px solid #2c3e50",t.style.borderRadius="8px",t.width=320,t.height=240,webgazer.setGazeListener((t,o)=>{t&&(console.log("检测到注视点:",t),this.checkGazePosition(t.x,t.y),this.loading=!1,this.gazeTimer||(console.log("启动5秒统计定时器..."),this.gazeTimer=setInterval(()=>{console.log("5秒统计周期触发"),this.determineZoomArea()},5e3)))})}catch(t){console.error("眼动跟踪初始化失败:",t),this.showErrorNotification(t),this.loading=!1}},showErrorNotification(t){this.$notify.error({title:"眼动跟踪初始化失败",message:`原因: ${t.message}`,duration:0,showClose:!0})},checkGazePosition(t,o){const e=Date.now(),i={a:this.$refs.boxA.getBoundingClientRect(),b:this.$refs.boxB.getBoundingClientRect(),c:this.$refs.boxC.getBoundingClientRect()};let n="g";for(const[s,a]of Object.entries(i))if(t>=a.left&&t<=a.right&&o>=a.top&&o<=a.bottom){n=s;break}if("g"!==n){this.gazeStartTime[n]||(this.gazeStartTime[n]=e,console.log(`开始注视区域 ${n}`));const i=e-(this.gazeStartTime[n]||e);this.gazeDuration[n]+=i,this.gazeStartTime[n]=e,console.log(`区域 ${n} 累计注视时间: ${this.gazeDuration[n]}ms`);const s=r.addGazePoint({x:t,y:o,aoi:n,duration:i},e);s&&(this.$set(this,"userType",s.userType),this.$set(this,"stats",s.stats),this.userTypeHistory.push(s),console.log("用户分类结果:",{type:s.userType,stats:s.stats,zoomArea:s.zoomedArea}),this.$forceUpdate())}else{const i=r.addGazePoint({x:t,y:o,aoi:"g",duration:100},e);i&&(this.userType=i.userType,this.stats=i.stats,this.userTypeHistory.push(i),console.log("用户分类结果:",i))}for(const s of["a","b","c","f"])n!==s&&this.gazeStartTime[s]&&(console.log(`离开区域 ${s}`),this.gazeStartTime[s]=null)},determineZoomArea(){console.log("5秒统计周期结束，开始分析注视数据");const t=r.getLastClassification();if(t)if(this.$set(this,"userType",t.userType),this.$set(this,"stats",t.stats),"direct"===t.userType)this.zoomArea("c");else if("referential"===t.userType){const t=Object.entries(this.gazeDuration).reduce((t,o)=>t[1]>o[1]?t:o)[0];this.gazeDuration[t]>0&&this.zoomArea(t)}else r.resetZoom();this.gazeDuration={a:0,b:0,c:0,f:0,g:0},console.log("已重置注视时间统计")},zoomArea(t){if(!t)return console.log("重置所有区域缩放"),void this.resetAllZoom();console.log(`准备放大区域 ${t}`),this.resetAllZoom();const o=this.$refs[`box${t.toUpperCase()}`];o?(o.style.transform="scale(1.5)",o.style.zIndex="10",o.style.transition="transform 0.3s ease",console.log(`已放大区域 ${t}`),this.currentZoom=t):console.error(`找不到区域 ${t} 的DOM元素`),this.gazeStartTime[t]=null},resetAllZoom(){["A","B","C"].forEach(t=>{const o=this.$refs[`box${t}`];o&&(o.style.transform="",o.style.zIndex="")}),this.currentZoom=null}}},d=u,h=e(1656),g=(0,h.A)(d,n,s,!1,null,null,null),p=g.exports,f=e(4927),m=e.n(f);i["default"].config.productionTip=!1,i["default"].use(m()),new i["default"]({render:t=>t(p)}).$mount("#app")}},o={};function e(i){var n=o[i];if(void 0!==n)return n.exports;var s=o[i]={id:i,loaded:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}e.m=t,function(){e.amdO={}}(),function(){var t=[];e.O=function(o,i,n,s){if(!i){var a=1/0;for(u=0;u<t.length;u++){i=t[u][0],n=t[u][1],s=t[u][2];for(var r=!0,c=0;c<i.length;c++)(!1&s||a>=s)&&Object.keys(e.O).every(function(t){return e.O[t](i[c])})?i.splice(c--,1):(r=!1,s<a&&(a=s));if(r){t.splice(u--,1);var l=n();void 0!==l&&(o=l)}}return o}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[i,n,s]}}(),function(){e.n=function(t){var o=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(o,{a:o}),o}}(),function(){e.d=function(t,o){for(var i in o)e.o(o,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:o[i]})}}(),function(){e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)}}(),function(){e.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){e.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={524:0};e.O.j=function(o){return 0===t[o]};var o=function(o,i){var n,s,a=i[0],r=i[1],c=i[2],l=0;if(a.some(function(o){return 0!==t[o]})){for(n in r)e.o(r,n)&&(e.m[n]=r[n]);if(c)var u=c(e)}for(o&&o(i);l<a.length;l++)s=a[l],e.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return e.O(u)},i=self["webpackChunkdemo"]=self["webpackChunkdemo"]||[];i.forEach(o.bind(null,0)),i.push=o.bind(null,i.push.bind(i))}();var i=e.O(void 0,[504],function(){return e(378)});i=e.O(i)})();
//# sourceMappingURL=app.39243b0c.js.map